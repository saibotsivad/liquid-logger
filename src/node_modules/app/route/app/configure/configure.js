import Configure from './Configure.svelte'
import getDailyGoal from 'app/api/get-daily-goal.js'
import setDailyGoal from 'app/api/set-daily-goal.js'

export default ({ asr }) => {
	asr.addState({
		name: 'app.configure',
		route: '/configure',
		defaultChild: 'container',
		template: Configure,
		resolve: async (data, parameters) => {
			const dailyGoal = await getDailyGoal()
			return {
				dailyGoal,
				initialDailyGoal: dailyGoal
			}
		},
		activate({ domApi }) {
			domApi.$on('dailyGoal', async event => {
				domApi.$set({ savingDailyGoal: true })
				await setDailyGoal(event.detail)
				domApi.$set({
					initialDailyGoal: event.detail,
					savingDailyGoal: false
				})
			})
		}
	})
}
